---
import { ArticleCard } from "../../components/ArticleCard";
import Page from "../../layouts/Page.astro";
import { PostCollections } from "../../shared/dataCache";
import { type CollectionEntry } from "astro:content";
import type { ArticlePost } from "../../types";

export async function getStaticPaths() {
  return PostCollections.getStaticPathsCategoryList();
}

type Props = CollectionEntry<"category">;

const hasCatAndCount = (obj: any): obj is { category: string; count: number } =>
  "category" in obj && "count" in obj;

const getProps = () => {
  let { category, count } = hasCatAndCount(Astro.props)
    ? Astro.props
    : hasCatAndCount(Astro.props.data)
      ? Astro.props.data
      : { category: "Invalid Category Page", count: -1 };

  return { category, count };
};
const { category, count } = getProps();
const posts = PostCollections.getPostsByCategory(category);

// console.log("category.astro.props", Astro.props);
---

<Page>

  <h1>{category}</h1>
  <p>Found {count} articles</p>
  <div class:list={["article-list"]}>
    {posts.map(post => (
      <ArticleCard article={post as ArticlePost} />
    ))}
  </div>
</Page>

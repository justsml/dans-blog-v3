---
import { type CollectionEntry, getCollection } from "astro:content";
import Main from "../layouts/Main.astro";
import { fixSlugPrefix } from "../shared/pathHelpers";

export async function getStaticPaths() {
  let posts = await getCollection("posts");

  let fixedPosts = posts.map((post) => ({
    slug: fixSlugPrefix(post.slug),
    params: { slug: fixSlugPrefix(post.slug) },
    props: { ...post, slug: post.slug },
  }));

  console.log("pages/[...slug]", fixedPosts[0]);

  return fixedPosts;
}

type Props = CollectionEntry<"posts">;

const post = Astro.props;
const results = await post.render();
const { Content } = results;
---

<Main title={post.data.title} subTitle={post.data.subTitle}>
  <Content />
</Main>

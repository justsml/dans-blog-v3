---
type Props = {
  googleAnalyticsId: string;
};

const { googleAnalyticsId } = Astro.props;

const analyticsId = googleAnalyticsId || "";
---

<span class:list={["analytics-tag", "hidden"]} data-google-id={analyticsId}
></span>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E35F2E1LWT"
></script>
<script is:inline>
  // DOM HACK TO GET THE GOOGLE ANALYTICS ID
  const googleAnalyticsId =
    document.querySelector("span.analytics-tag")?.dataset?.googleId;

  //// STANDARDISH GA CODE
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());

  gtag("config", googleAnalyticsId);
</script>

<script is:inline>
  function trackCustomEvent({
    category,
    action,
    label,
    value,
    nonInteraction = false,
    transport,
    hitCallback,
    callbackTimeout = 100,
  }) {
    if (typeof window !== `undefined` && window.ga) {
      const trackingEventOptions = {
        eventCategory: category,
        eventAction: action,
        eventLabel: label,
        eventValue: value,
        nonInteraction: nonInteraction,
        transport,
      };

      if (hitCallback && typeof hitCallback === `function`) {
        trackingEventOptions.hitCallback = () =>
          setTimeout(hitCallback, callbackTimeout);
      }

      window.ga(`send`, `event`, trackingEventOptions);
    }
  }
</script>
